apiVersion: v1
kind: ConfigMap
metadata:
  name: todolist-config
  namespace: todolist
data:
  mysql-port: "3306"
  mysql-database: "todolist_demo"
  redis-port: "6379"
  redis-database: "0"
  frontend-url: "https://app.todolist.com"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: todolist-config-files
  namespace: todolist
data:
  config.prod.yaml: |
    server:
      mode: release
      port: "8080"
      host: "0.0.0.0"
      read_timeout: 30s
      write_timeout: 30s
      idle_timeout: 60s

    database:
      mysql:
        host: $(MYSQL_HOST)
        port: $(MYSQL_PORT)
        username: $(MYSQL_USERNAME)
        password: $(MYSQL_PASSWORD)
        database: $(MYSQL_DATABASE)
        charset: utf8mb4
        parse_time: true
        loc: Local
        max_idle_conns: 20
        max_open_conns: 100
        conn_max_lifetime: 3600s
      
      redis:
        host: $(REDIS_HOST)
        port: $(REDIS_PORT)
        password: $(REDIS_PASSWORD)
        database: $(REDIS_DATABASE)
        pool_size: 20
        min_idle_conns: 10
        dial_timeout: 5s
        read_timeout: 3s
        write_timeout: 3s

    jwt:
      secret: $(JWT_SECRET)
      expires_in: 24h
      issuer: "todolist-demo"

    logger:
      level: info
      format: json
      output: stdout

    cors:
      allowed_origins:
        - "$(FRONTEND_URL)"
      allowed_methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      allowed_headers:
        - Origin
        - Content-Type
        - Accept
        - Authorization
        - X-Requested-With
      exposed_headers:
        - X-Total-Count
      allow_credentials: true
      max_age: 86400

    swagger:
      enabled: false
      path: /swagger
      title: "Todo List API"
      description: "A high-performance todo list microservice"
      version: "1.0"

    rate_limit:
      enabled: true
      requests_per_minute: 100
      burst: 200